[platformio]
default_envs = esp32, native_test

; ============================================
; ESP32 Production Environment
; ============================================
[env:esp32]
platform = espressif32
board = esp32dev
framework = esphome

build_flags = 
    -DUSE_ESP32

; ============================================
; Native Testing Environment (Linux/Mac/Windows)
; Uses conditional compilation with UNIT_TEST flag
; ============================================
[env:native_test]
platform = native
test_framework = googletest

; Critical: Define UNIT_TEST to use mocks instead of real ESP APIs
build_flags = 
    -DUNIT_TEST=1
    -DIS_NODE=1
    -std=c++17
    -Wall -Wextra
    -Wno-error=unused-variable
    -Wno-error=unused-parameter

; Include paths
build_src_filter = 
    +<../components/esp_mesh/*.cpp>
    +<../components/esp_mesh/*.h>

test_build_src = yes

; Library dependencies
lib_deps = 
    google/googletest

; Verbose output for debugging
test_verbose = true
