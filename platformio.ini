[platformio]
default_envs = native_test

; ============================================
; ESP32 Production Environment
; (Disabled for CI/CD - requires full ESPHome setup)
; ============================================
; [env:esp32]
; platform = espressif32
; board = esp32dev
; framework = esphome
; 
; build_flags = 
;     -DUSE_ESP32

; ============================================
; Native Testing Environment (Linux/Mac/Windows)
; Uses conditional compilation with UNIT_TEST flag
; ============================================
[env:native_test]
platform = native
test_framework = googletest

; Critical: Define UNIT_TEST to use mocks instead of real ESP APIs
build_flags = 
    -DUNIT_TEST=1
    -DIS_NODE=1
    -std=c++17
    -Wall -Wextra
    -Wno-error=unused-variable
    -Wno-error=unused-parameter
    -Wno-sign-compare

; Include paths
build_src_filter = 
    +<../components/esp_mesh/*.cpp>
    +<../components/esp_mesh/*.h>

test_build_src = yes

; Library dependencies
lib_deps = 
    google/googletest

; Verbose output for debugging
test_verbose = true

; ============================================
; Native Testing with Code Coverage
; ============================================
[env:native_test_coverage]
platform = native
test_framework = googletest

; Enable coverage flags
build_flags = 
    -DUNIT_TEST=1
    -DIS_NODE=1
    -std=c++17
    -Wall -Wextra
    -Wno-error=unused-variable
    -Wno-error=unused-parameter
    -Wno-sign-compare
    ; Coverage flags
    -O0
    -g
    --coverage
    -fprofile-arcs
    -ftest-coverage

; Link with gcov
build_unflags = 
    -Os
    -O2

extra_scripts = 
    pre:scripts/setup_coverage.py

; Include paths
build_src_filter = 
    +<../components/esp_mesh/*.cpp>
    +<../components/esp_mesh/*.h>

test_build_src = yes

; Library dependencies
lib_deps = 
    google/googletest

; Verbose output
test_verbose = true
